module.exports=[69562,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(46271),f=a.i(62036),g=a.i(97895),h=a.i(53250),i=a.i(83103),j=a.i(43335),k=a.i(38867),l=a.i(85085);function m({opacity:a=20}){let c=`border-foreground/${a}`;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:`absolute top-2 left-2 w-3 h-3 border-t border-l ${c}`}),(0,b.jsx)("div",{className:`absolute top-2 right-2 w-3 h-3 border-t border-r ${c}`}),(0,b.jsx)("div",{className:`absolute bottom-2 left-2 w-3 h-3 border-b border-l ${c}`}),(0,b.jsx)("div",{className:`absolute bottom-2 right-2 w-3 h-3 border-b border-r ${c}`})]})}function n(){let a=(0,d.useSearchParams)(),j=(0,d.useRouter)(),{walletAddress:k,connect:n,isConnecting:p}=(0,l.useWallet)(),q=a.get("network")||"",r=a.get("agentId")||"",s=a.get("hireId"),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(s),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!0),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(0),[N,O]=(0,c.useState)(0),P=(0,c.useRef)(null),Q=(0,c.useRef)(null),R=(0,c.useRef)(null),S=(0,c.useCallback)(()=>{P.current?.scrollIntoView({behavior:"smooth"})},[]);async function T(){if(!x||!B.trim()||F)return;let a=B.trim(),b=D.length>0?[...D]:void 0,c={role:"user",text:a,timestamp:new Date().toISOString(),hasFiles:!!b};A(a=>[...a,c]),C(""),E([]),G(!0),K(null),R.current&&(R.current.style.height="auto");try{let c=await (0,h.apiWorkspaceCall)(x,a,b),d={role:"agent",text:c.response||"(No response)",timestamp:new Date().toISOString()};A(a=>[...a,d]),M(c.callsUsed),O(c.callsTotal)}catch(b){let a=b instanceof Error?b.message:"Failed to send message";K(a),A(b=>[...b,{role:"agent",text:`Error: ${a}`,timestamp:new Date().toISOString()}])}finally{G(!1)}}async function U(){if(x)try{await (0,h.apiWorkspaceClear)(x),A([])}catch{}}if((0,c.useEffect)(()=>{S()},[z,S]),(0,c.useEffect)(()=>{q&&r?async function(){try{let a=await (0,h.apiGetAgent)(q,r);u(a);let b=s;if(!b&&k){let a=await (0,h.apiCheckActiveHire)(k,q,r);a.active&&a.hire&&(b=a.hire.hireId)}if(b){y(b);let a=await (0,h.apiGetHireStatus)(b);w(a),M(Number(a.callsUsed)||0),O(Number(a.callsTotal)||0);let c=await (0,h.apiWorkspaceHistory)(b);if(c.history&&c.history.length>0){let a=[];for(let b of c.history)a.push({role:"user",text:b.userMessage,timestamp:b.timestamp,hasFiles:b.hasFiles}),a.push({role:"agent",text:b.agentResponse,timestamp:b.timestamp});A(a)}}}catch(a){K(a instanceof Error?a.message:"Failed to load workspace")}finally{I(!1)}}():I(!1)},[q,r,s,k]),!q||!r)return(0,b.jsx)("div",{className:"h-full w-full relative flex flex-col overflow-hidden",children:(0,b.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center",children:(0,b.jsx)("div",{className:"border border-error-red/40 bg-error-red/5 px-6 py-4",children:(0,b.jsx)("span",{className:"font-mono text-xs uppercase tracking-wider text-error-red",children:"Missing network or agentId parameter"})})})});if(H)return(0,b.jsx)("div",{className:"h-full w-full relative flex flex-col overflow-hidden",children:(0,b.jsx)("div",{className:"flex-1 flex flex-col items-center pt-24 pb-16 px-4 md:px-8",children:(0,b.jsxs)("div",{className:"w-full max-w-3xl animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-8 w-48 bg-muted-foreground/10 rounded"}),(0,b.jsx)("div",{className:"h-24 bg-muted-foreground/10 rounded"}),(0,b.jsx)("div",{className:"flex-1 h-64 bg-muted-foreground/10 rounded"})]})})});if(!k)return(0,b.jsx)("div",{className:"h-full w-full relative flex flex-col overflow-hidden",children:(0,b.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:(0,b.jsxs)("div",{className:"border border-border p-8 relative text-center max-w-md",children:[(0,b.jsx)(m,{}),(0,b.jsx)("h2",{className:"font-mono text-lg font-bold uppercase tracking-wider text-foreground mb-2",children:"CONNECT WALLET"}),(0,b.jsx)("p",{className:"font-mono text-xs text-muted-foreground mb-6",children:"Connect your wallet to access the workspace"}),(0,b.jsx)("button",{onClick:n,disabled:p,className:"font-mono text-xs uppercase tracking-widest bg-foreground text-background px-8 py-3 hover:opacity-90 disabled:opacity-30",children:p?"CONNECTING...":"CONNECT"})]})})});if(!x||!v&&!H)return(0,b.jsx)("div",{className:"h-full w-full relative flex flex-col overflow-hidden",children:(0,b.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:(0,b.jsxs)("div",{className:"border border-border p-8 relative text-center max-w-md",children:[(0,b.jsx)(m,{}),(0,b.jsx)("h2",{className:"font-mono text-lg font-bold uppercase tracking-wider text-foreground mb-2",children:"NO ACTIVE HIRE"}),(0,b.jsx)("p",{className:"font-mono text-xs text-muted-foreground mb-6",children:"You need to hire this agent before using the workspace"}),(0,b.jsx)("button",{onClick:()=>j.push(`/hire?network=${q}&agentId=${r}`),className:"font-mono text-xs uppercase tracking-widest bg-foreground text-background px-8 py-3 hover:opacity-90",children:"HIRE AGENT"})]})})});let V=v&&new Date(v.expiresAt)<new Date,W=L>=N,X=!F&&!V&&!W&&v?.status==="active",Y=Math.max(0,N-L),Z=N>0?Math.min(100,L/N*100):0,$=i.CONTRACTS[q]?.name||q,_=t?.a2aEndpoint?"A2A":t?.mcpEndpoint?"MCP":"HTTP";return(0,b.jsxs)("div",{className:"h-[calc(100vh-64px)] w-full relative flex flex-col overflow-hidden",children:[(0,b.jsx)("div",{className:"border-b border-border px-4 md:px-8 py-3 flex-shrink-0",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,b.jsx)("button",{onClick:()=>j.back(),className:"font-mono text-xs uppercase tracking-widest text-muted-foreground hover:text-foreground transition-colors flex-shrink-0",children:"â†"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:(0,g.cn)("h-2 w-2 rounded-full flex-shrink-0",t?.status==="active"?"bg-system-green":"bg-error-red")}),(0,b.jsx)("span",{className:"font-mono text-sm font-bold uppercase tracking-wider text-foreground truncate",children:t?.name||"Agent"}),(0,b.jsxs)("span",{className:"font-mono text-[9px] text-muted-foreground/50 flex-shrink-0",children:["#",r]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(0,b.jsx)("span",{className:"font-mono text-[8px] uppercase tracking-wider text-muted-foreground/40",children:$}),(0,b.jsx)("span",{className:"font-mono text-[8px] uppercase tracking-wider text-info-blue/60",children:_})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-shrink-0",children:[(0,b.jsxs)("div",{className:"hidden sm:flex flex-col items-end gap-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"font-mono text-[9px] uppercase tracking-wider text-muted-foreground/50",children:[Y.toLocaleString()," calls left"]}),(0,b.jsxs)("span",{className:(0,g.cn)("font-mono text-[9px] uppercase tracking-wider",Z>90?"text-error-red":Z>70?"text-warning-amber":"text-system-green"),children:[Z.toFixed(0),"%"]})]}),(0,b.jsx)("div",{className:"w-32 h-1 bg-muted-foreground/10 overflow-hidden",children:(0,b.jsx)("div",{className:(0,g.cn)("h-full transition-all",Z>90?"bg-error-red":Z>70?"bg-warning-amber":"bg-system-green"),style:{width:`${Z}%`}})})]}),(0,b.jsx)("button",{onClick:U,className:"font-mono text-[9px] uppercase tracking-widest px-3 py-1.5 border border-border hover:border-foreground/30 text-muted-foreground hover:text-foreground transition-colors",title:"Clear conversation",children:"NEW CHAT"})]})]})}),(V||W)&&(0,b.jsx)("div",{className:"border-b border-error-red/30 bg-error-red/5 px-4 py-2 flex-shrink-0",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-mono text-xs uppercase tracking-wider text-error-red",children:V?"Hire expired":"No calls remaining"}),(0,b.jsx)("button",{onClick:()=>j.push(`/hire?network=${q}&agentId=${r}`),className:"font-mono text-[9px] uppercase tracking-widest px-3 py-1 bg-error-red/10 border border-error-red/30 text-error-red hover:bg-error-red/20 transition-colors",children:"RENEW"})]}),(0,b.jsx)(o,{agent:t,network:q,agentId:r})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto no-scrollbar px-4 md:px-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto py-6 space-y-1",children:[0===z.length?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center pt-24 pb-16",children:(0,b.jsxs)("div",{className:"border border-border/40 p-8 relative text-center max-w-md",children:[(0,b.jsx)(m,{opacity:10}),(0,b.jsx)("div",{className:"font-mono text-3xl text-foreground/10 mb-4",children:">_"}),(0,b.jsx)("h3",{className:"font-mono text-sm font-bold uppercase tracking-widest text-foreground/40 mb-2",children:"WORKSPACE READY"}),(0,b.jsxs)("p",{className:"font-mono text-[10px] text-muted-foreground/40 leading-relaxed",children:["Send a message to start interacting with"," ",(0,b.jsx)("span",{className:"text-foreground/60",children:t?.name||"this agent"}),". You can also attach files for the agent to process."]})]})}):(0,b.jsx)(f.AnimatePresence,{initial:!1,children:z.map((a,c)=>(0,b.jsxs)(e.motion.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.15},className:(0,g.cn)("py-4",c>0&&z[c-1].role!==a.role?"border-t border-border/20":""),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("span",{className:(0,g.cn)("font-mono text-[9px] uppercase tracking-widest font-bold","user"===a.role?"text-info-blue":"text-system-green"),children:"user"===a.role?"YOU":t?.name?.toUpperCase()||"AGENT"}),(0,b.jsx)("span",{className:"font-mono text-[8px] text-muted-foreground/30",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),a.hasFiles&&(0,b.jsx)("span",{className:"font-mono text-[8px] text-warning-amber/60 border border-warning-amber/20 px-1",children:"FILES"})]}),(0,b.jsx)("div",{className:(0,g.cn)("font-mono text-[12px] leading-relaxed whitespace-pre-wrap break-words","user"===a.role?"text-foreground/80":"text-foreground",a.text.startsWith("Error:")?"text-error-red":""),children:a.text})]},c))}),F&&(0,b.jsxs)(e.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"py-4 border-t border-border/20",children:[(0,b.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,b.jsx)("span",{className:"font-mono text-[9px] uppercase tracking-widest font-bold text-system-green",children:t?.name?.toUpperCase()||"AGENT"})}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"h-1.5 w-1.5 bg-system-green/60 rounded-full animate-pulse"}),(0,b.jsx)("span",{className:"h-1.5 w-1.5 bg-system-green/60 rounded-full animate-pulse [animation-delay:150ms]"}),(0,b.jsx)("span",{className:"h-1.5 w-1.5 bg-system-green/60 rounded-full animate-pulse [animation-delay:300ms]"}),(0,b.jsx)("span",{className:"font-mono text-[10px] text-muted-foreground/40 ml-2",children:"Processing..."})]})]}),(0,b.jsx)("div",{ref:P})]})}),(0,b.jsx)("div",{className:"border-t border-border px-4 md:px-8 py-4 flex-shrink-0 bg-background",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[D.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:D.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-1.5 border border-border px-2 py-1 bg-muted-foreground/5",children:[(0,b.jsx)("span",{className:"font-mono text-[9px] text-foreground/70 truncate max-w-[120px]",children:a.name}),(0,b.jsx)("button",{onClick:()=>{E(a=>a.filter((a,b)=>b!==c))},className:"font-mono text-[9px] text-error-red hover:text-error-red/80",children:"x"})]},c))}),J&&(0,b.jsx)("div",{className:"border border-error-red/30 bg-error-red/5 px-3 py-2 mb-3",children:(0,b.jsx)("span",{className:"font-mono text-[10px] text-error-red",children:J})}),(0,b.jsxs)("div",{className:"flex items-end gap-3",children:[(0,b.jsx)("button",{onClick:()=>Q.current?.click(),disabled:!X,className:"font-mono text-xs px-3 py-2.5 border border-border hover:border-foreground/30 text-muted-foreground hover:text-foreground transition-colors disabled:opacity-30 disabled:cursor-not-allowed flex-shrink-0",title:"Attach files",children:"+"}),(0,b.jsx)("input",{ref:Q,type:"file",multiple:!0,onChange:function(a){let b=a.target.files;b&&(Array.from(b).forEach(a=>{let b=new FileReader;b.onload=()=>{let c=b.result.split(",")[1];E(b=>[...b,{name:a.name,data:c,mimeType:a.type||"application/octet-stream"}])},b.readAsDataURL(a)}),a.target.value="")},className:"hidden"}),(0,b.jsx)("div",{className:"flex-1 border border-border focus-within:border-foreground/30 transition-colors relative",children:(0,b.jsx)("textarea",{ref:R,value:B,onChange:function(a){C(a.target.value);let b=a.target;b.style.height="auto",b.style.height=Math.min(b.scrollHeight,160)+"px"},onKeyDown:function(a){"Enter"!==a.key||a.shiftKey||(a.preventDefault(),T())},disabled:!X,placeholder:X?"Type a message... (Shift+Enter for new line)":"Cannot send messages",rows:1,className:"w-full bg-transparent font-mono text-xs text-foreground placeholder:text-muted-foreground/30 px-4 py-3 resize-none outline-none disabled:opacity-30 disabled:cursor-not-allowed",style:{maxHeight:"160px"}})}),(0,b.jsx)("button",{onClick:T,disabled:!X||!B.trim(),className:(0,g.cn)("font-mono text-xs uppercase tracking-widest px-6 py-2.5 transition-colors flex-shrink-0",X&&B.trim()?"bg-foreground text-background hover:opacity-90":"bg-muted-foreground/10 text-muted-foreground/30 cursor-not-allowed"),children:F?"...":"SEND"})]}),(0,b.jsxs)("div",{className:"sm:hidden mt-3 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"font-mono text-[8px] uppercase tracking-wider text-muted-foreground/40",children:[Y.toLocaleString()," / ",N.toLocaleString()," calls remaining"]}),(0,b.jsx)("div",{className:"w-20 h-1 bg-muted-foreground/10 overflow-hidden",children:(0,b.jsx)("div",{className:(0,g.cn)("h-full",Z>90?"bg-error-red":Z>70?"bg-warning-amber":"bg-system-green"),style:{width:`${Z}%`}})})]})]})})]})}function o({agent:a,network:d,agentId:e}){let{walletAddress:f,signer:h}=(0,l.useWallet)(),[n,o]=(0,c.useState)(5),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),z=i.CONTRACTS[d];async function A(){if(f&&h&&e&&z){s(!0),w(null);try{let b=`I give feedback score ${n}/5 to agent #${e} (${a?.name||"agent"}) on ${z.name} via 8004agent.network`,c=await h.signMessage(b),d={network:z.facinetNetwork,chainId:z.chainId},g=await (0,j.selectFacilitator)(d),l=k.ethers.keccak256(k.ethers.toUtf8Bytes(c));await (0,j.facinetExecuteContract)(d,{contractAddress:z.reputationRegistry,functionName:"giveFeedback",functionArgs:[e,n,0,"rating",p||"",a?.url||"",`sig:${f}`,l],abi:i.REPUTATION_REGISTRY_ABI},g),u(!0)}catch(a){w(a instanceof Error?a.message:String(a))}finally{s(!1)}}}return((0,c.useEffect)(()=>{f&&e&&z&&a();async function a(){try{let a=new k.ethers.JsonRpcProvider(z.rpc),b=new k.ethers.Contract(z.reputationRegistry,i.REPUTATION_REGISTRY_ABI,a);Number(await b.getLastIndex(e,f))>0&&y(!0)}catch{}}},[f,e,z]),t)?(0,b.jsx)("div",{className:"border border-system-green/30 bg-system-green/5 p-4",children:(0,b.jsx)("span",{className:"font-mono text-xs uppercase tracking-wider text-system-green",children:"Thank you for your feedback! It has been recorded on-chain."})}):x?(0,b.jsx)("div",{className:"border border-border/60 p-4 text-center",children:(0,b.jsx)("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground/50",children:"You have already submitted feedback for this agent"})}):(0,b.jsxs)("div",{className:"border border-border p-4 relative",children:[(0,b.jsx)(m,{opacity:10}),(0,b.jsxs)("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground/60 block mb-3",children:["How was your experience with ",a?.name||"this agent","?"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[[1,2,3,4,5].map(a=>(0,b.jsx)("button",{onClick:()=>o(a),className:(0,g.cn)("w-9 h-9 font-mono text-sm font-bold border transition-colors",a===n?"border-foreground bg-foreground text-background":"border-border text-muted-foreground hover:border-foreground/30 hover:text-foreground"),children:a},a)),(0,b.jsx)("span",{className:"font-mono text-[9px] text-muted-foreground/40 ml-2",children:"/5"})]}),(0,b.jsx)("textarea",{value:p,onChange:a=>q(a.target.value),placeholder:"Optional comment...",rows:2,className:"w-full bg-transparent border border-border px-3 py-2 font-mono text-xs text-foreground placeholder:text-muted-foreground/30 focus:outline-none focus:border-foreground/40 transition-colors resize-none no-scrollbar mb-3"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:A,disabled:r,className:"font-mono text-[10px] uppercase tracking-widest bg-foreground text-background px-5 py-2 hover:opacity-90 disabled:opacity-30",children:r?"Submitting...":"Submit Feedback"}),(0,b.jsx)("span",{className:"font-mono text-[8px] text-muted-foreground/40 uppercase tracking-wider",children:"Gas covered by Facinet"})]}),v&&(0,b.jsx)("div",{className:"mt-2 border border-error-red/30 bg-error-red/5 px-3 py-1.5",children:(0,b.jsx)("span",{className:"font-mono text-[10px] text-error-red",children:v})})]})}function p(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"h-full w-full relative flex flex-col overflow-hidden",children:(0,b.jsx)("div",{className:"flex-1 flex flex-col items-center pt-24 pb-16 px-4 md:px-8",children:(0,b.jsxs)("div",{className:"w-full max-w-3xl animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-8 w-48 bg-muted-foreground/10 rounded"}),(0,b.jsx)("div",{className:"h-24 bg-muted-foreground/10 rounded"}),(0,b.jsx)("div",{className:"flex-1 h-64 bg-muted-foreground/10 rounded"})]})})}),children:(0,b.jsx)(n,{})})}a.s(["default",()=>p])}];

//# sourceMappingURL=app_workspace_page_tsx_b600575a._.js.map